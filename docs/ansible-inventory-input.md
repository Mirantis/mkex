# Ansible Inventory Parameters

## 1. Inventory Sources
Types of Inventory files
- **Static Inventory**: Defined in a file (e.g., `inventory.yaml` file). Usually, generated manually.
- **Dynamic Inventory**: Generated by a script or plugin. In our case, our terraform provision module and **vsphere**: `mkex-install/terraform/vsphere` 

## 2. Host Parameters
- **Host Name**: The Name or IPAddress which will be assigned to the newly created host.
  - Example: `mkex-mngr1`
- **Variables**: Key-value pairs associated with the host.
  - Example: `ansible_connection` `ansible_ssh_private_key_file` `ansible_host`, `ansible_user`, `ansible_port`
  ```yaml
    hosts:
        # mkex-mngr1
        mkex-mngr1:
        ansible_connection: ssh
        ansible_ssh_private_key_file: /Users/mkex/Desktop/terraform/vsphere/ssh-keys/mkex.pem
        ansible_user: test
        ansible_host: 172.18.180.147

        # mkex-wrk1
        mkex-wrk1:
        ansible_connection: ssh
        ansible_ssh_private_key_file: /Users/mkex/Desktop/terraform/vsphere/ssh-keys/mkex.pem
        ansible_user: test
        ansible_host: 172.18.180.149
  ```

## 3. Group Parameters
- **Children Groups**: Nested groups within a group.
  - Example: `children`, `managers`
  ```yaml
  children:
    managers:
      hosts:
        mkex-mngr1:
    workers:
      hosts:
        mkex-wrk1:  
  ```

## 4. Special Groups
- **all**: A built-in group that contains all hosts.
  ```yaml
    all:
        hosts:
            # mkex-mngr1
    ...
  ```
## 5. Variables 
- **vars**: A list of key-value pairs, which will be populate and/or overwrite variables with the same key in the ansible playbook.
    - Example:
      ```yaml
      vars:
        mke_url: 172.18.180.147
      ```
## 6. Inventory File Structure
Here is a full inventory file example (with dummy values):
- **YAML Format**: Modern format using the YAML syntax.
  - Example:
    ```yaml
    all:
        hosts:
            # mkex-mngr1
            mkex-mngr1:
            ansible_connection: ssh
            ansible_ssh_private_key_file: /Users/mkex/Desktop/terraform/vsphere/ssh-keys/mkex.pem
            ansible_user: test
            ansible_host: 172.18.180.147

            # mkex-wrk1
            mkex-wrk1:
            ansible_connection: ssh
            ansible_ssh_private_key_file: /Users/mkex/Desktop/terraform/vsphere/ssh-keys/mkex.pem
            ansible_user: test
            ansible_host: 172.18.180.149
        children:
            managers:
            hosts:
                mkex-mngr1:
            workers:
            hosts:
                mkex-wrk1:
        vars:
            mke_url: 172.18.180.147
    ```

# FAQ
### How to generate ansible inventory from our Terraform provision modules
Since we have created our terraform charts with the thought of coupling it with ansible, it's very easy to generate inventory file. 

  1. In the terraform directory of the appropriate provider e.g. for vsphere **mkex-install/terraform/vsphere/**, execute the command `terraform apply`
  2. Execute `terraform output -raw ansible_inventory`
  3. The output can be simply be redirected and saved as a yaml file.
  4. Profit! You have an Ansible inventory file
